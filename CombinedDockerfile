# ---- Stage 1: Build Angular App ----
FROM node:18 AS angular-build
WORKDIR /app
COPY xevo-game/package.json xevo-game/package-lock.json ./
RUN npm install
COPY xevo-game/ ./
RUN npm run build --prod

# ---- Stage 2: xevo-api ----
FROM node:18
WORKDIR /usr/src/app

# Install xevo-api dependencies
COPY xevo-api/package.json xevo-api/package-lock.json ./
RUN npm install

# Copy built Angular files from Stage 1
COPY --from=angular-build /app/dist/public ./public

# Copy xevo-api source code
COPY xevo-api/ .

# Expose API port
EXPOSE 3000

# Start xevo-api
CMD ["npm", "start"]
